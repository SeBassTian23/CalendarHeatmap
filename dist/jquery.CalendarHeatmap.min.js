/*
 *  jquery-calendar-heatmap - v1.1.0
 *  A simple Calendar Heatmap for jQuery.
 *  https://github.com/SeBassTian23/CalendarHeatmap
 *
 *  Made by Sebastian Kuhlgert
 *  Under MIT License
 */

!function(v){"use strict";var n="CalendarHeatmap",a={title:null,months:12,weekStartDay:1,lastMonth:moment().month()+1,lastYear:moment().year(),coloring:null,labels:{days:!1,months:!0,custom:{weekDayLabels:null,monthLabels:null}},tiles:{shape:"square"},legend:{show:!0,align:"right",minLabel:"Less",maxLabel:"More",divider:" to "},tooltips:{show:!1,options:{}}};function i(t,e,s){this.element=t,this.data=e,this.settings=v.extend(!0,{},a,s),this._defaults=a,this._name=n,this.init()}v.extend(i.prototype,{init:function(){this.calendarHeatmap(),moment||console.log("The calendar heatmap plugin requires moment.js")},_parse:function(t){var e=[];if(!Array.isArray(t)||"object"!=typeof t)return console.log("Invalid data source"),null;if(Array.isArray(t)&&0<t.length){var s=typeof t[0];if("object"!=typeof t[0]||Array.isArray(t[0])){if(-1<["string","date","number"].indexOf(s)){if(moment(t[0]).isValid()){var a,n,i={};for(a in t){var l=moment(t[a]).format("YYYY-MM-DD");i[l]?i[l]+=1:i[l]=1}for(n in e=[],i)e.push({count:parseInt(i[n]),date:n});return e}return console.log("Invalid Date format."),null}return console.log("Invalid format."),null}if(t[0].date&&t[0].count){for(var o in e=[],t){var r=t[o].date;v.isNumeric(t[o].date)&&(r=parseInt(t[o].date)),e.push({count:parseInt(t[o].count),date:moment(r).format("YYYY-MM-DD")})}return e}return console.log("Invalid Object format."),null}if(Array.isArray(t)&&0===t.length)return[];if("object"!=typeof t||Object.empty(t))return null;s=Object.keys(t);if(!moment(s[0]).isValid())return console.log("Invalid Date format."),null;if(this._isNumeric(t[s[0]])){var h,d=[];for(h in t)d.push({count:parseInt(t[h]),date:moment(h).format("YYYY-MM-DD")});return d}},_pad:function(t,e){return(t=String(t)).length<e?this._pad("0"+t,e):t},_calculateBins:function(t){var e,s=this.settings.steps||4,a=["0"],n=[[0,0]],i=t.map(function(t){return parseInt(t.count)}),l=Math.min.apply(Math,i),i=Math.max.apply(Math,i),o=Math.ceil((i-l)/s);for(0===o&&(o=i/s)<1&&(o=1),n=[[0,0]],a=Number.isFinite(l)?["0"]:[""],e=0;e<s;e++){var r=o*e+1,h=o*(e+1);n.push([r,h]),!Number.isFinite(l)||Number.isNaN(r)||!Number.isFinite(r)?a.push(""):r==h?a.push(String(r)):a.push(String(r)+(this.settings.legend.divider||" to ")+String(h))}for(e in t)t[e].level=this._matchBin(n,t[e].count);return{events:t,bins:a}},_matchBin:function(t,e){for(var s in t)if(e>=t[s][0]&&e<=t[s][1])return parseInt(s);return 0},_matchDate:function(t,e){return t.find(function(t){return t.date===e})||null},_matchDateIdx:function(t,e){return t.findIndex(function(t){return t.date===e})},_futureDate:function(t){return 0<=moment(t).diff(moment(),"days")&&moment(t).format("YYYY-MM-DD")!==moment().format("YYYY-MM-DD")},_isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},_addWeekColumn:function(){if(this.settings.labels.days){v(".ch-year",this.element).append('<div class="ch-week-labels"></div>'),v(".ch-week-labels",this.element).append('<div class="ch-week-label-col"></div>'),v(".ch-week-label-col",this.element).append('<div class="ch-day-labels"></div>'),this.settings.labels.months&&v(".ch-week-labels",this.element).append('<div class="ch-month-label">&nbsp;</div>');for(var t=this.settings.weekStartDay,e=0;e<7;e++){var s,a=moment().weekday(e+t).format("ddd"),n=moment().weekday(e+t).format("d");(e-1)%2?(s=this.settings.labels.custom.weekDayLabels,Array.isArray(s)?a=s[n]||"":"string"==typeof s&&(a=moment().weekday(e+t).format(s))):a="&nbsp;",v("<div>",{class:"ch-day-label",html:a}).appendTo(v(".ch-day-labels",this.element))}}},calendarHeatmap:function(){var t=this._parse(this.data);if(Array.isArray(t)){this.data=t;var e,t=this._calculateBins(t),s=t.events,a=t.bins,n=this.settings.lastMonth,i=this.settings.lastYear,t=this.settings.months,l=this.settings.weekStartDay||1;for(v(this.element).empty(),this.settings.title&&v("<h3>",{class:"ch-title",html:this.settings.title}).appendTo(v(this.element)),v(this.element).addClass("ch").append('<div class="ch-year"></div>'),this._addWeekColumn(),this.settings.tiles.shape&&"square"!==this.settings.tiles.shape&&v(this.element).addClass(" ch-"+this.settings.tiles.shape),e=t;0<e;e--){var o=n-e,r=i;o<0&&(--r,o+=12);var h=moment().set({month:o,year:r}).format("MMM");this.settings.labels.custom.monthLabels&&(h=Array.isArray(this.settings.labels.custom.monthLabels)?this.settings.labels.custom.monthLabels[o]||"":moment().set({month:o,year:r}).format(this.settings.labels.custom.monthLabels)),v(".ch-year",this.element).append('<div class="ch-month"></div>'),v(".ch-month:last",this.element).append('<div class="ch-weeks"></div>'),this.settings.labels.months&&v(".ch-month:last",this.element).append('<div class="ch-month-label">'+h+"</div>");var d=moment().set({month:o,year:r}).daysInMonth();v(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week"></div>');for(var c=0,m=0;m<d;m++){var p=r+"-"+this._pad(o+1,2);p+="-"+this._pad(m+1,2);var u,f=this._matchDate(s,p),g="";this._futureDate(p)&&(g=" is-after-today"),f?(u=f.count+" on ",u+=moment(f.date).format("ll"),p="",this.settings.coloring&&(p=" "+this.settings.coloring+"-"+f.level),v("<div/>",{class:"ch-day lvl-"+f.level+p,title:u,"data-toggle":"tooltip"}).appendTo(v(".ch-month:last .ch-weeks .ch-week:last",this.element))):v("<div/>",{class:"ch-day"+g}).appendTo(v(".ch-month:last .ch-weeks .ch-week:last",this.element)),c++,moment().set({date:m+2,month:o,year:r}).isoWeekday()===l&&m<d-1&&(v(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week">'+m+"</div>"),c=0)}for(;c<7;c++)v(".ch-month:last .ch-weeks .ch-week:last",this.element).append('<div class="ch-day is-outside-month"></div>')}if(this.settings.legend.show)for(v("<div>",{class:"ch-legend"}).appendTo(this.element).append("<small>"+(this.settings.legend.minLabel||"")+"</small>").append('<ul class="ch-lvls"></ul>').append("<small>"+(this.settings.legend.maxLabel||"")+"</small>"),"left"===this.settings.legend.align&&v(".ch-legend",this.element).addClass("ch-legend-left"),"center"===this.settings.legend.align&&v(".ch-legend",this.element).addClass("ch-legend-center"),e=0;e<a.length;e++)v("<li>",{class:"ch-lvl lvl-"+e,title:a[e],"data-toggle":"tooltip"}).appendTo(v(".ch-lvls",this.element)),this.settings.coloring&&v(".ch-lvls li:last",this.element).addClass(this.settings.coloring+"-"+e);this.settings.tooltips.show&&"function"==typeof v.fn.tooltip&&v('[data-toggle="tooltip"]',this.element).tooltip(this.settings.tooltips.options)}},updateDates:function(t){this.data=t,this.calendarHeatmap()},appendDates:function(t){var e=this._parse(t);if(Array.isArray(e)&&Array.isArray(this.data))for(var s in e){var a=this._matchDateIdx(this.data,e[s].date);-1<a?this.data[a].count+=e[s].count:this.data.push(e[s])}this.calendarHeatmap()},updateOptions:function(t){this.settings=v.extend(!0,{},this.settings,t),this.calendarHeatmap()},getDates:function(){return this.data},getOptions:function(){return this.settings}}),v.fn[n]=function(e,t){var s,a=arguments;return Array.isArray(e)?this.each(function(){v.data(this,"plugin_"+n)||v.data(this,"plugin_"+n,new i(this,e,t))}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(this.each(function(){var t=v.data(this,"plugin_"+n);t instanceof i&&"function"==typeof t[e]&&(s=t[e].apply(t,Array.prototype.slice.call(a,1))),"destroy"===e&&v(this).removeData()}),void 0!==s?s:this):void 0}}(jQuery);